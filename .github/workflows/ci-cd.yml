name: CI/CD Pipeline

on:
  workflow_call:
    inputs:
      java-version:
        type: string
        default: "17"

      docker-platforms:
        type: string
        default: "linux/amd64,linux/arm64"

      sonar-token:
        type: string
        default: ""

      enable-security-scan:
        type: boolean
        default: true

      run-tests:
        type: boolean
        default: true

      event-name:
        type: string

      debug-mode:
        type: boolean
        default: false
        description: "Enable verbose debug logging"

    secrets:
      DOCKER_USERNAME:
        required: false
      DOCKER_PASSWORD:
        required: false
      SONAR_TOKEN:
        required: false
      TC_CLOUD_TOKEN:
        required: false

    outputs:
      image-tag:
        value: ${{ jobs.docker.outputs.image-tag }}

permissions:
  contents: read
  checks: write
  pull-requests: write
  issues: write

env:
  REGISTRY: docker.io
  IMAGE_NAME: ${{ github.repository }}

jobs:

  #######################################
  # BUILD + UNIT TESTS
  #######################################
  build:
    name: ğŸ—ï¸ Build & Unit Tests
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ¯ Print Build Configuration
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "               ğŸ—ï¸  BUILD CONFIGURATION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ“¦ Repository:        ${{ github.repository }}"
          echo "ğŸ”€ Branch:            ${{ github.ref_name }}"
          echo "ğŸ“ Commit:            ${{ github.sha }}"
          echo "ğŸ‘¤ Triggered by:      ${{ github.actor }}"
          echo "â˜• Java Version:      ${{ inputs.java-version }}"
          echo "ğŸ§ª Run Tests:         ${{ inputs.run-tests }}"
          echo "ğŸ› Debug Mode:        ${{ inputs.debug-mode }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: ${{ inputs.java-version }}
          distribution: "temurin"
          cache: "maven"

      - name: ğŸ“Š Display Java Environment
        run: |
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚                   Java Environment Info                     â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          java -version
          mvn -version
          echo ""

      - name: ğŸ”¨ Build Application (Skip Tests)
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ              ğŸ”¨ Building Application                       â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          
          if [ "${{ inputs.debug-mode }}" == "true" ]; then
            mvn -B -X clean package -DskipTests
          else
            mvn -B clean package -DskipTests
          fi
          
          echo ""
          echo "âœ… Build completed successfully!"

      - name: ğŸ§ª Run Unit Tests
        if: ${{ inputs.run-tests }}
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ              ğŸ§ª Running Unit Tests                         â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          echo "â° Started at: $(date '+%Y-%m-%d %H:%M:%S')"
          echo ""
          
          START_TIME=$(date +%s)
          
          if [ "${{ inputs.debug-mode }}" == "true" ]; then
            mvn -B -X test
          else
            mvn -B test
          fi
          
          END_TIME=$(date +%s)
          DURATION=$((END_TIME - START_TIME))
          
          echo ""
          echo "âœ… Tests completed in ${DURATION}s"
          echo "â° Finished at: $(date '+%Y-%m-%d %H:%M:%S')"

      - name: ğŸ“Š Publish Unit Test Results
        if: ${{ always() && inputs.run-tests }}
        uses: EnricoMi/publish-unit-test-result-action@v2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          files: |
            target/surefire-reports/*.xml
          check_name: Unit Test Results

      - name: ğŸ“ˆ Build Summary
        if: always()
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘                  ğŸ—ï¸  BUILD & UNIT TESTS                     â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“‹ Configuration" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Setting | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|---------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| â˜• Java Version | \`${{ inputs.java-version }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ“¦ Repository | \`${{ github.repository }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ”€ Branch | \`${{ github.ref_name }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ‘¤ Triggered By | ${{ github.actor }} |" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ job.status }}" == "success" ]; then
            echo "| ğŸ¯ Build Status | âœ… **SUCCESS** |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ğŸ¯ Build Status | âŒ **FAILED** |" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ inputs.run-tests }}" == "true" ] && [ -d "target/surefire-reports" ]; then
            TESTS=$(find target/surefire-reports -name "*.xml" -exec grep -h "tests=" {} \; 2>/dev/null | sed 's/.*tests="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
            FAILURES=$(find target/surefire-reports -name "*.xml" -exec grep -h "failures=" {} \; 2>/dev/null | sed 's/.*failures="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
            ERRORS=$(find target/surefire-reports -name "*.xml" -exec grep -h "errors=" {} \; 2>/dev/null | sed 's/.*errors="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
            SKIPPED=$(find target/surefire-reports -name "*.xml" -exec grep -h "skipped=" {} \; 2>/dev/null | sed 's/.*skipped="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
            
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ğŸ§ª Test Results" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Metric | Count | Percentage |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|-------|------------|" >> $GITHUB_STEP_SUMMARY
            echo "| ğŸ“Š Total Tests | **${TESTS:-0}** | 100% |" >> $GITHUB_STEP_SUMMARY
            
            if [ "${TESTS:-0}" -gt 0 ]; then
              PASS=$((${TESTS:-0} - ${FAILURES:-0} - ${ERRORS:-0}))
              PASS_PCT=$((PASS * 100 / ${TESTS:-1}))
              echo "| âœ… Passed | **${PASS}** | ${PASS_PCT}% |" >> $GITHUB_STEP_SUMMARY
            fi
            
            if [ "${FAILURES:-0}" -gt 0 ]; then
              FAIL_PCT=$((${FAILURES:-0} * 100 / ${TESTS:-1}))
              echo "| âŒ Failed | **${FAILURES}** | ${FAIL_PCT}% |" >> $GITHUB_STEP_SUMMARY
            else
              echo "| âŒ Failed | 0 | 0% |" >> $GITHUB_STEP_SUMMARY
            fi
            
            if [ "${ERRORS:-0}" -gt 0 ]; then
              ERR_PCT=$((${ERRORS:-0} * 100 / ${TESTS:-1}))
              echo "| âš ï¸ Errors | **${ERRORS}** | ${ERR_PCT}% |" >> $GITHUB_STEP_SUMMARY
            else
              echo "| âš ï¸ Errors | 0 | 0% |" >> $GITHUB_STEP_SUMMARY
            fi
            
            if [ "${SKIPPED:-0}" -gt 0 ]; then
              SKIP_PCT=$((${SKIPPED:-0} * 100 / ${TESTS:-1}))
              echo "| â­ï¸ Skipped | **${SKIPPED}** | ${SKIP_PCT}% |" >> $GITHUB_STEP_SUMMARY
            fi
            
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "</div>" >> $GITHUB_STEP_SUMMARY
            
            if [ "${FAILURES:-0}" -eq 0 ] && [ "${ERRORS:-0}" -eq 0 ]; then
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "### ğŸ‰ All Tests Passed!" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "```" >> $GITHUB_STEP_SUMMARY
              echo "    âœ¨ Perfect Score! âœ¨" >> $GITHUB_STEP_SUMMARY
              echo "   ğŸ¯ ${TESTS} / ${TESTS} Tests Passing" >> $GITHUB_STEP_SUMMARY
              echo "```" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "</div>" >> $GITHUB_STEP_SUMMARY
            fi
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ” Merge Sonar Token
        env:
          INPUT_TOKEN: ${{ inputs.sonar-token }}
          SECRET_TOKEN: ${{ secrets.SONAR_TOKEN }}
        run: |
          if [ -n "$INPUT_TOKEN" ]; then
            echo "ğŸ”‘ Using input sonar token"
            echo "SONAR_TOKEN_SAFE=$INPUT_TOKEN" >> $GITHUB_ENV
          else
            echo "ğŸ”‘ Using secret sonar token"
            echo "SONAR_TOKEN_SAFE=$SECRET_TOKEN" >> $GITHUB_ENV
          fi

      - name: ğŸ” SonarCloud Scan
        if: ${{ env.SONAR_TOKEN_SAFE != '' }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SONAR_TOKEN: ${{ env.SONAR_TOKEN_SAFE }}
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ              ğŸ” Running SonarCloud Scan                    â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          mvn -B sonar:sonar -Dsonar.login=${{ env.SONAR_TOKEN }} -Dsonar.java.a3s.enable=false
          echo ""
          echo "âœ… SonarCloud scan completed!"

      - name: ğŸ“¦ Upload JAR Artifact
        uses: actions/upload-artifact@v4
        with:
          name: application-jar
          path: target/*.jar
          retention-days: 7
          
      - name: ğŸ“ Log Artifact Upload
        run: |
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚              ğŸ“¦ Artifact Upload Complete                    â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          ls -lh target/*.jar
          echo ""
          echo "âœ… JAR artifacts uploaded successfully"


  #######################################
  # TESTCONTAINERS INTEGRATION TESTS
  #######################################
  testcontainers:
    name: ğŸ§ª Integration Tests
    runs-on: ubuntu-latest
    needs: build
    if: ${{ inputs.run-tests }}

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ¯ Print Test Configuration
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "          ğŸ§ª  INTEGRATION TESTS CONFIGURATION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ³ Test Type:         Testcontainers"
          echo "â˜• Java Version:      ${{ inputs.java-version }}"
          echo "ğŸ› Debug Mode:        ${{ inputs.debug-mode }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: ${{ inputs.java-version }}
          distribution: "temurin"
          cache: "maven"

      - name: ğŸ³ Start Docker Service
        run: |
          echo "ğŸ³ Starting Docker daemon..."
          sudo systemctl start docker
          echo "âœ… Docker started successfully"
          docker --version

      - name: ğŸ§ª Run Integration Tests
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ          ğŸ§ª Running Integration Tests                      â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          echo "â° Started at: $(date '+%Y-%m-%d %H:%M:%S')"
          echo ""
          
          START_TIME=$(date +%s)
          
          if [ "${{ inputs.debug-mode }}" == "true" ]; then
            mvn -B -X -Ptestcontainers verify
          else
            mvn -B -Ptestcontainers verify
          fi
          
          END_TIME=$(date +%s)
          DURATION=$((END_TIME - START_TIME))
          
          echo ""
          echo "âœ… Integration tests completed in ${DURATION}s"
          echo "â° Finished at: $(date '+%Y-%m-%d %H:%M:%S')"

      - name: ğŸ“Š Publish Integration Test Results
        if: always()
        uses: EnricoMi/publish-unit-test-result-action@v2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          files: |
            target/surefire-reports/*.xml
            target/failsafe-reports/*.xml
          check_name: Integration Test Results

      - name: ğŸ“ˆ Integration Tests Summary
        if: always()
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘              ğŸ§ª  INTEGRATION TESTS RESULTS                  â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -d "target/failsafe-reports" ]; then
            TESTS=$(find target/failsafe-reports -name "*.xml" -exec grep -h "tests=" {} \; 2>/dev/null | sed 's/.*tests="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
            FAILURES=$(find target/failsafe-reports -name "*.xml" -exec grep -h "failures=" {} \; 2>/dev/null | sed 's/.*failures="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
            ERRORS=$(find target/failsafe-reports -name "*.xml" -exec grep -h "errors=" {} \; 2>/dev/null | sed 's/.*errors="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
            
            echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Metric | Value | Status |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|-------|--------|" >> $GITHUB_STEP_SUMMARY
            echo "| ğŸ“Š Total Tests | **${TESTS:-0}** | - |" >> $GITHUB_STEP_SUMMARY
            
            if [ "${TESTS:-0}" -gt 0 ]; then
              PASS=$((${TESTS:-0} - ${FAILURES:-0} - ${ERRORS:-0}))
              echo "| âœ… Passed | **${PASS}** | ğŸ¯ |" >> $GITHUB_STEP_SUMMARY
            fi
            
            if [ "${FAILURES:-0}" -gt 0 ]; then
              echo "| âŒ Failures | **${FAILURES}** | âš ï¸ |" >> $GITHUB_STEP_SUMMARY
            else
              echo "| âŒ Failures | 0 | âœ… |" >> $GITHUB_STEP_SUMMARY
            fi
            
            if [ "${ERRORS:-0}" -gt 0 ]; then
              echo "| âš ï¸ Errors | **${ERRORS}** | ğŸš¨ |" >> $GITHUB_STEP_SUMMARY
            else
              echo "| âš ï¸ Errors | 0 | âœ… |" >> $GITHUB_STEP_SUMMARY
            fi
            
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "</div>" >> $GITHUB_STEP_SUMMARY
            
            if [ "${FAILURES:-0}" -eq 0 ] && [ "${ERRORS:-0}" -eq 0 ]; then
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "### ğŸŠ All Integration Tests Passed!" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "```" >> $GITHUB_STEP_SUMMARY
              echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
              echo "  â•‘   âœ¨ PERFECT SCORE! âœ¨   â•‘" >> $GITHUB_STEP_SUMMARY
              echo "  â•‘  ${TESTS} / ${TESTS} Tests Passing  â•‘" >> $GITHUB_STEP_SUMMARY
              echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
              echo "```" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "</div>" >> $GITHUB_STEP_SUMMARY
            else
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "### âš ï¸ Some Tests Failed" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "Please review the test logs for detailed error information." >> $GITHUB_STEP_SUMMARY
            fi
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ“¦ Upload Test Reports
        uses: actions/upload-artifact@v4
        with:
          name: testcontainers-reports
          path: |
            target/surefire-reports/**
            target/failsafe-reports/**
          retention-days: 14


  #######################################
  # DOCKER BUILD & PUSH
  #######################################
  docker:
    name: ğŸ³ Docker Build & Push
    runs-on: ubuntu-latest
    needs: build
    if: ${{ always() && !cancelled() && needs.build.result == 'success' && inputs.event-name != 'pull_request' }}
    outputs:
      image-tag: ${{ steps.save-tag.outputs.image-tag }}

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ¯ Print Docker Configuration
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "             ğŸ³  DOCKER BUILD CONFIGURATION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ·ï¸  Registry:         ${{ env.REGISTRY }}"
          echo "ğŸ“¦ Image Name:        ${{ env.IMAGE_NAME }}"
          echo "ğŸ–¥ï¸  Platforms:        ${{ inputs.docker-platforms }}"
          echo "ğŸ”€ Branch:            ${{ github.ref_name }}"
          echo "ğŸ“ Commit SHA:        ${{ github.sha }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: ğŸ”§ Setup QEMU
        uses: docker/setup-qemu-action@v3
        
      - name: ğŸ”§ Setup Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ğŸ” Login to Docker Registry
        uses: docker/login-action@v3
        with:
          registry: "docker.io"
          username: ${{ secrets.DOCKER_USERNAME || github.actor }}
          password: ${{ secrets.DOCKER_PASSWORD || secrets.GITHUB_TOKEN }}
          
      - name: âœ… Docker Login Success
        run: |
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚          ğŸ” Docker Registry Login Successful               â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"

      - name: ğŸ·ï¸ Generate Docker Metadata
        id: meta
        uses: docker/metadata-action@v5
        with:
          images: docker.io/${{ env.IMAGE_NAME }}
          tags: |
            type=raw,value=latest
            type=ref,event=branch
            type=ref,event=pr
            type=semver,pattern={{version}}
            type=semver,pattern={{major}}.{{minor}}
            type=sha

      - name: ğŸ“ Extract Primary Image Tag
        id: save-tag
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ              ğŸ·ï¸  Extracting Image Tags                    â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          
          TAGS="${{ steps.meta.outputs.tags }}"
          echo "ğŸ“‹ All generated tags:"
          echo "$TAGS"
          echo ""
          
          PRIMARY_TAG=$(echo "$TAGS" | head -n 1)
          echo "ğŸ¯ Primary tag selected: $PRIMARY_TAG"
          
          echo "$PRIMARY_TAG" > image-tag.txt
          echo "image-tag=$PRIMARY_TAG" >> $GITHUB_OUTPUT
          
          echo ""
          echo "âœ… Tag saved successfully"

      - name: ğŸ”¨ Build and Push Docker Image
        uses: docker/build-push-action@v5
        with:
          context: .
          platforms: ${{ inputs.docker-platforms }}
          push: true
          tags: ${{ steps.meta.outputs.tags }}
          labels: ${{ steps.meta.outputs.labels }}
          
      - name: âœ… Docker Build Complete
        run: |
          echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
          echo "â”‚          ğŸ‰ Docker Image Built & Pushed Successfully       â”‚"
          echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
          echo ""
          echo "ğŸ“¦ Image: ${{ steps.save-tag.outputs.image-tag }}"

      - name: ğŸ“ˆ Docker Build Summary
        if: always()
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘              ğŸ³  DOCKER BUILD & PUSH RESULTS                â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“‹ Build Details" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Detail | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ·ï¸ Registry | \`${{ env.REGISTRY }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ“¦ Image | \`${{ env.IMAGE_NAME }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ¯ Primary Tag | \`${{ steps.save-tag.outputs.image-tag }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ–¥ï¸ Platforms | \`${{ inputs.docker-platforms }}\` |" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ job.status }}" == "success" ]; then
            echo "| âœ… Status | **SUCCESS** ğŸ‰ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| âŒ Status | **FAILED** ğŸ˜ |" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ·ï¸ All Generated Tags:" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.meta.outputs.tags }}" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ job.status }}" == "success" ]; then
            echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ğŸš€ Docker Image Ready for Deployment!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Pull the image:" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
            echo "docker pull ${{ steps.save-tag.outputs.image-tag }}" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "</div>" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ“„ Generate SBOM
        uses: anchore/sbom-action@v0
        with:
          image: ${{ steps.save-tag.outputs.image-tag }}
          format: spdx-json
          output-file: sbom.spdx.json

      - name: ğŸ“¦ Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: sbom
          path: sbom.spdx.json

      - name: ğŸ“¦ Upload Image Tag
        uses: actions/upload-artifact@v4
        with:
          name: image-tag
          path: image-tag.txt
          retention-days: 1


  #######################################
  # SMOKE TESTS (Continuation in next file due to length...)
  #######################################
  smoke-tests:
    name: ğŸ’¨ Smoke Tests
    runs-on: ubuntu-latest
    needs: docker
    if: ${{ always() && !cancelled() && needs.docker.result == 'success' }}

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      # âœ… CRITICAL FIX: Login to Docker Hub FIRST (before TC Cloud setup)
      - name: ğŸ³ Login to Docker Hub
        uses: docker/login-action@v3
        with:
          registry: docker.io
          username: ${{ secrets.DOCKER_USERNAME || github.actor }}
          password: ${{ secrets.DOCKER_PASSWORD || secrets.GITHUB_TOKEN }}

      # âœ… NEW: Pre-pull Ryuk image to avoid runtime pull issues
      - name: ğŸ“¥ Pre-pull Ryuk Image
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ           ğŸ“¥ Pre-pulling Testcontainers Images            â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          echo "ğŸ”„ Pulling Ryuk cleanup container..."
          docker pull testcontainers/ryuk:0.5.1
          echo "âœ… Ryuk image ready"
          echo ""

      # âœ… NEW: Verify Docker setup
      - name: ğŸ” Verify Docker Setup
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "            ğŸ³ Docker Configuration Check"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          echo "ğŸ“‹ Docker Version:"
          docker version --format '{{.Server.Version}}'
          echo ""
          
          echo "ğŸ” Authentication Status:"
          if docker info 2>/dev/null | grep -q "Username:"; then
            echo "âœ… Authenticated to Docker Hub"
          else
            echo "âš ï¸  Not authenticated (may hit rate limits)"
          fi
          echo ""
          
          echo "ğŸ“¦ Pre-pulled Images:"
          docker images testcontainers/ryuk:0.5.1
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: ğŸ” Check Testcontainers Cloud Token
        id: check-token
        env:
          TC_CLOUD_TOKEN: ${{ secrets.TC_CLOUD_TOKEN }}
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "        ğŸ’¨  SMOKE TESTS CONFIGURATION CHECK"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          if [ -z "$TC_CLOUD_TOKEN" ]; then
            echo "âš ï¸  WARNING: Testcontainers Cloud token not available"
            echo "ğŸ“ Smoke tests will be skipped"
            echo "ğŸ’¡ Add TC_CLOUD_TOKEN secret to enable smoke tests"
            echo "has-token=false" >> $GITHUB_OUTPUT
          else
            echo "âœ… Testcontainers Cloud token detected"
            echo "ğŸš€ Smoke tests will run"
            echo "has-token=true" >> $GITHUB_OUTPUT
          fi
          
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: ğŸ“¥ Download Image Tag
        if: steps.check-token.outputs.has-token == 'true'
        uses: actions/download-artifact@v4
        with:
          name: image-tag

      - name: ğŸ·ï¸ Get Image Tag
        if: steps.check-token.outputs.has-token == 'true'
        id: get-tag
        run: |
          JOB_OUTPUT="${{ needs.docker.outputs.image-tag }}"
          
          if [ -n "$JOB_OUTPUT" ]; then
            IMAGE_TAG="$JOB_OUTPUT"
            echo "âœ… Using image tag from job output: $IMAGE_TAG"
          elif [ -f "image-tag.txt" ]; then
            IMAGE_TAG=$(cat image-tag.txt)
            echo "âœ… Using image tag from artifact: $IMAGE_TAG"
          else
            echo "âŒ ERROR: Could not get image tag" >&2
            exit 1
          fi
          
          echo "image-tag=$IMAGE_TAG" >> $GITHUB_OUTPUT

      - name: â˜• Setup Java
        if: steps.check-token.outputs.has-token == 'true'
        uses: actions/setup-java@v4
        with:
          java-version: ${{ inputs.java-version }}
          distribution: "temurin"
          cache: "maven"

      - name: âš™ï¸ Configure Testcontainers Cloud
        if: steps.check-token.outputs.has-token == 'true'
        uses: atomicjar/testcontainers-cloud-setup-action@v1
        with:
          token: ${{ secrets.TC_CLOUD_TOKEN }}
          wait-for-agent: true

      - name: ğŸ’¨ Run Smoke Tests
        if: steps.check-token.outputs.has-token == 'true'
        env:
          # Testcontainers Cloud
          TC_CLOUD_TOKEN: ${{ secrets.TC_CLOUD_TOKEN }}
          TESTCONTAINERS_CLOUD_TOKEN: ${{ secrets.TC_CLOUD_TOKEN }}
          
          # Docker configuration
          DOCKER_HOST: unix:///var/run/docker.sock
          
          # âœ… Ryuk configuration (cleanup container)
          TESTCONTAINERS_RYUK_DISABLED: false
          TESTCONTAINERS_RYUK_CONTAINER_TIMEOUT: 60s
          TESTCONTAINERS_RYUK_CONTAINER_PRIVILEGED: false
          
          # âœ… Image pull configuration
          TESTCONTAINERS_HUB_IMAGE_NAME_PREFIX: ""
          
          # Test configuration
          IMAGE_TAG: ${{ steps.get-tag.outputs.image-tag }}
          TESTCONTAINERS_REUSE_ENABLE: false
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ              ğŸ’¨ Running Smoke Tests                        â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          echo "ğŸ³ Image: $IMAGE_TAG"
          echo "ğŸŒ©ï¸  Platform: Testcontainers Cloud"
          echo "â° Started at: $(date '+%Y-%m-%d %H:%M:%S')"
          echo ""
          
          # âœ… Show environment for debugging
          echo "ğŸ“‹ Test Environment:"
          echo "  â€¢ TESTCONTAINERS_CLOUD_TOKEN: ${TESTCONTAINERS_CLOUD_TOKEN:+SET}"
          echo "  â€¢ DOCKER_HOST: $DOCKER_HOST"
          echo "  â€¢ TESTCONTAINERS_RYUK_DISABLED: $TESTCONTAINERS_RYUK_DISABLED"
          echo ""
          
          MAX_ATTEMPTS=3
          ATTEMPT=1
          
          while [ $ATTEMPT -le $MAX_ATTEMPTS ]; do
            echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
            echo "Attempt $ATTEMPT of $MAX_ATTEMPTS"
            echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
            
            if mvn -B -Dtest=EnhancedSmokeTest test; then
              echo ""
              echo "âœ… Smoke tests PASSED on attempt $ATTEMPT"
              exit 0
            else
              if [ $ATTEMPT -lt $MAX_ATTEMPTS ]; then
                echo "âš ï¸  Attempt $ATTEMPT FAILED - retrying in 30s..."
                sleep 30
              else
                echo "âŒ All $MAX_ATTEMPTS attempts FAILED"
                exit 1
              fi
            fi
            
            ATTEMPT=$((ATTEMPT + 1))
          done

      - name: ğŸ“Š Publish Smoke Test Results
        if: always() && steps.check-token.outputs.has-token == 'true'
        uses: EnricoMi/publish-unit-test-result-action@v2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          files: |
            target/surefire-reports/*.xml
          check_name: Smoke Test Results

      - name: ğŸ“ˆ Smoke Tests Summary
        if: always()
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘              ğŸ’¨  SMOKE TESTS RESULTS                        â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ "${{ steps.check-token.outputs.has-token }}" != "true" ]; then
            echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### â­ï¸ Smoke Tests Skipped" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ Testcontainers Cloud token not available" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "To enable smoke tests:" >> $GITHUB_STEP_SUMMARY
            echo "1. Get a token from [Testcontainers Cloud](https://testcontainers.com/cloud)" >> $GITHUB_STEP_SUMMARY
            echo "2. Add \`TC_CLOUD_TOKEN\` to repository secrets" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "</div>" >> $GITHUB_STEP_SUMMARY
          else
            echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### Test Configuration" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Detail | Value |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
            echo "| ğŸ³ Image Tag | \`${{ steps.get-tag.outputs.image-tag }}\` |" >> $GITHUB_STEP_SUMMARY
            echo "| ğŸŒ©ï¸ Platform | Testcontainers Cloud |" >> $GITHUB_STEP_SUMMARY
            echo "| ğŸ¯ Status | **${{ job.status }}** |" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "</div>" >> $GITHUB_STEP_SUMMARY
            
            if [ -d "target/surefire-reports" ]; then
              TESTS=$(find target/surefire-reports -name "*.xml" -exec grep -h "tests=" {} \; 2>/dev/null | sed 's/.*tests="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
              FAILURES=$(find target/surefire-reports -name "*.xml" -exec grep -h "failures=" {} \; 2>/dev/null | sed 's/.*failures="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
              ERRORS=$(find target/surefire-reports -name "*.xml" -exec grep -h "errors=" {} \; 2>/dev/null | sed 's/.*errors="\([0-9]*\)".*/\1/' | awk '{s+=$1} END {print s}')
              
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "### ğŸ“Š Test Results" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "| Metric | Count |" >> $GITHUB_STEP_SUMMARY
              echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
              echo "| ğŸ“Š Total | **${TESTS:-0}** |" >> $GITHUB_STEP_SUMMARY
              echo "| âœ… Passed | **$((${TESTS:-0} - ${FAILURES:-0} - ${ERRORS:-0}))** |" >> $GITHUB_STEP_SUMMARY
              echo "| âŒ Failed | **${FAILURES:-0}** |" >> $GITHUB_STEP_SUMMARY
              echo "| âš ï¸ Errors | **${ERRORS:-0}** |" >> $GITHUB_STEP_SUMMARY
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "</div>" >> $GITHUB_STEP_SUMMARY
              
              if [ "${FAILURES:-0}" -eq 0 ] && [ "${ERRORS:-0}" -eq 0 ]; then
                echo "" >> $GITHUB_STEP_SUMMARY
                echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
                echo "" >> $GITHUB_STEP_SUMMARY
                echo "### ğŸ‰ All Smoke Tests Passed!" >> $GITHUB_STEP_SUMMARY
                echo "" >> $GITHUB_STEP_SUMMARY
                echo "```" >> $GITHUB_STEP_SUMMARY
                echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
                echo "  â•‘  âœ¨ SMOKE FREE! âœ¨   â•‘" >> $GITHUB_STEP_SUMMARY
                echo "  â•‘   ${TESTS} / ${TESTS} Passing    â•‘" >> $GITHUB_STEP_SUMMARY
                echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
                echo "```" >> $GITHUB_STEP_SUMMARY
                echo "" >> $GITHUB_STEP_SUMMARY
                echo "</div>" >> $GITHUB_STEP_SUMMARY
              fi
            fi
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY


  #######################################
  # SECURITY SCAN
  #######################################
  security:
    name: ğŸ”’ Security Scan
    runs-on: ubuntu-latest
    needs: [docker, smoke-tests]
    if: |
      always() && !cancelled() && 
      needs.docker.result == 'success' && 
      (needs.smoke-tests.result == 'success' || needs.smoke-tests.result == 'skipped') && 
      inputs.enable-security-scan
    permissions:
      contents: read
      security-events: write

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ¯ Print Security Scan Configuration
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "            ğŸ”’  SECURITY SCAN CONFIGURATION"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ” OWASP Dependency Check: Enabled"
          echo "ğŸ” CodeQL Analysis:        Enabled"
          echo "â˜• Java Version:           ${{ inputs.java-version }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: ${{ inputs.java-version }}
          distribution: "temurin"
          cache: "maven"

      - name: ğŸ›¡ï¸ Run OWASP Dependency Check
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ           ğŸ›¡ï¸  OWASP Dependency Check                      â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          echo "â° Started at: $(date '+%Y-%m-%d %H:%M:%S')"
          echo ""
          
          mvn -B org.owasp:dependency-check-maven:check \
            -Dformat=HTML \
            -Dformat=JSON \
            -DfailBuildOnCVSS=7
          
          echo ""
          echo "âœ… OWASP scan completed"
        continue-on-error: true

      - name: ğŸ“¦ Upload OWASP Report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: owasp-report
          path: |
            target/dependency-check-report.html
            target/dependency-check-report.json
          retention-days: 30
          if-no-files-found: warn

      - name: ğŸ” Initialize CodeQL
        uses: github/codeql-action/init@v4
        with:
          languages: "java"

      - name: ğŸ”¨ Build for CodeQL
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“"
          echo "â”ƒ              ğŸ”¨ Building for CodeQL Analysis              â”ƒ"
          echo "â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›"
          echo ""
          mvn -B clean package -DskipTests
          echo ""
          echo "âœ… Build complete"

      - name: ğŸ” Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v4

      - name: ğŸ“ˆ Security Scan Summary
        if: always()
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘              ğŸ”’  SECURITY SCAN RESULTS                      â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Scan Type | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ›¡ï¸ OWASP Dependency Check | âœ… Complete |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ” CodeQL Analysis | âœ… Complete |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ“Š Report Locations" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ›¡ï¸ **OWASP Report**: Check the \`owasp-report\` artifact" >> $GITHUB_STEP_SUMMARY
          echo "- ğŸ” **CodeQL Results**: View in the Security â†’ Code scanning alerts tab" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -f "target/dependency-check-report.html" ]; then
            echo "âœ… OWASP report generated successfully" >> $GITHUB_STEP_SUMMARY
          else
            echo "â„¹ï¸ No dependencies to check or scan was skipped" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY


  #######################################
  # PRODUCTION DEPLOY
  #######################################
  deploy-production:
    name: ğŸš€ Production Deploy
    runs-on: ubuntu-latest
    needs: [docker, security]
    if: |
      always() && !cancelled() && 
      needs.docker.result == 'success' && 
      (needs.security.result == 'success' || needs.security.result == 'skipped') && 
      startsWith(github.ref, 'refs/tags/v')
    
    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ¯ Print Deployment Information
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "           ğŸš€  PRODUCTION DEPLOYMENT"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸ·ï¸  Tag:              ${{ github.ref_name }}"
          echo "ğŸ“ Commit:            ${{ github.sha }}"
          echo "ğŸ‘¤ Triggered by:      ${{ github.actor }}"
          echo "ğŸ³ Image Tag:         ${{ needs.docker.outputs.image-tag }}"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: ğŸ“ˆ Deployment Summary
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘              ğŸš€  PRODUCTION DEPLOYMENT                      â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ¯ Deployment Details" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Detail | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸŒ Environment | **Production** |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ·ï¸ Tag | \`${{ github.ref_name }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ“ Commit | \`${{ github.sha }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ³ Image | \`${{ needs.docker.outputs.image-tag }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ‘¤ Deployed By | ${{ github.actor }} |" >> $GITHUB_STEP_SUMMARY
          echo "| â° Time | $(date '+%Y-%m-%d %H:%M:%S UTC') |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ‰ Deployment Successful!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "```" >> $GITHUB_STEP_SUMMARY
          echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "  â•‘  ğŸš€ DEPLOYED TO PRODUCTION ğŸš€ â•‘" >> $GITHUB_STEP_SUMMARY
          echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "```" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ“ Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          generate_release_notes: true
          token: ${{ secrets.GITHUB_TOKEN }}


  #######################################
  # FINAL PIPELINE SUMMARY
  #######################################
  pipeline-summary:
    name: ğŸ“Š Pipeline Summary
    runs-on: ubuntu-latest
    needs: [build, testcontainers, docker, smoke-tests, security]
    if: always()
    
    steps:
      - name: ğŸ“Š Generate Comprehensive Pipeline Summary
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
          echo "â•‘                                                                â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•‘            ğŸ¯ CI/CD PIPELINE EXECUTION SUMMARY                â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•‘                                                                â•‘" >> $GITHUB_STEP_SUMMARY
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“‹ Workflow Information" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Info | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ”¢ Run Number | #${{ github.run_number }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ‘¤ Triggered By | ${{ github.actor }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ”€ Branch | \`${{ github.ref_name }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ“ Commit | \`${{ github.sha }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| â° Started | $(date '+%Y-%m-%d %H:%M:%S UTC') |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ­ Job Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Job | Result |" >> $GITHUB_STEP_SUMMARY
          echo "|-----|--------|" >> $GITHUB_STEP_SUMMARY
          
          # Build job
          if [ "${{ needs.build.result }}" == "success" ]; then
            echo "| ğŸ—ï¸ Build & Unit Tests | âœ… **SUCCESS** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.build.result }}" == "failure" ]; then
            echo "| ğŸ—ï¸ Build & Unit Tests | âŒ **FAILED** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.build.result }}" == "skipped" ]; then
            echo "| ğŸ—ï¸ Build & Unit Tests | â­ï¸ Skipped |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ğŸ—ï¸ Build & Unit Tests | âš ï¸ Cancelled |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # Integration tests
          if [ "${{ needs.testcontainers.result }}" == "success" ]; then
            echo "| ğŸ§ª Integration Tests | âœ… **SUCCESS** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.testcontainers.result }}" == "failure" ]; then
            echo "| ğŸ§ª Integration Tests | âŒ **FAILED** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.testcontainers.result }}" == "skipped" ]; then
            echo "| ğŸ§ª Integration Tests | â­ï¸ Skipped |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ğŸ§ª Integration Tests | âš ï¸ Cancelled |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # Docker
          if [ "${{ needs.docker.result }}" == "success" ]; then
            echo "| ğŸ³ Docker Build & Push | âœ… **SUCCESS** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.docker.result }}" == "failure" ]; then
            echo "| ğŸ³ Docker Build & Push | âŒ **FAILED** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.docker.result }}" == "skipped" ]; then
            echo "| ğŸ³ Docker Build & Push | â­ï¸ Skipped |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ğŸ³ Docker Build & Push | âš ï¸ Cancelled |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # Smoke tests
          if [ "${{ needs.smoke-tests.result }}" == "success" ]; then
            echo "| ğŸ’¨ Smoke Tests | âœ… **SUCCESS** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.smoke-tests.result }}" == "failure" ]; then
            echo "| ğŸ’¨ Smoke Tests | âŒ **FAILED** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.smoke-tests.result }}" == "skipped" ]; then
            echo "| ğŸ’¨ Smoke Tests | â­ï¸ Skipped |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ğŸ’¨ Smoke Tests | âš ï¸ Cancelled |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # Security
          if [ "${{ needs.security.result }}" == "success" ]; then
            echo "| ğŸ”’ Security Scan | âœ… **SUCCESS** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.security.result }}" == "failure" ]; then
            echo "| ğŸ”’ Security Scan | âŒ **FAILED** |" >> $GITHUB_STEP_SUMMARY
          elif [ "${{ needs.security.result }}" == "skipped" ]; then
            echo "| ğŸ”’ Security Scan | â­ï¸ Skipped |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ğŸ”’ Security Scan | âš ï¸ Cancelled |" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # Overall status with ASCII art
          if [ "${{ needs.build.result }}" == "success" ] && \
             [ "${{ needs.docker.result }}" == "success" ] && \
             ([ "${{ needs.smoke-tests.result }}" == "success" ] || [ "${{ needs.smoke-tests.result }}" == "skipped" ]) && \
             ([ "${{ needs.security.result }}" == "success" ] || [ "${{ needs.security.result }}" == "skipped" ]); then
            echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "## ğŸ‰ PIPELINE SUCCESS!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘                                       â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘     âœ¨ ALL CHECKS PASSED! âœ¨         â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘                                       â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘    ğŸ—ï¸  Build         âœ…              â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘    ğŸ§ª Tests         âœ…              â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘    ğŸ³ Docker        âœ…              â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘    ğŸ”’ Security      âœ…              â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘                                       â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘        ğŸš€ READY TO DEPLOY! ğŸš€        â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘                                       â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "</div>" >> $GITHUB_STEP_SUMMARY
          else
            echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "## âŒ PIPELINE FAILED" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘                                       â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘     âš ï¸  PIPELINE FAILED  âš ï¸          â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘                                       â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘  Please review the failed jobs above  â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•‘                                       â•‘" >> $GITHUB_STEP_SUMMARY
            echo "  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "</div>" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [ -n "${{ needs.docker.outputs.image-tag }}" ]; then
            echo "### ğŸ³ Docker Image" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
            echo "docker pull ${{ needs.docker.outputs.image-tag }}" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "<div align='center'>" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ğŸ“ Artifacts** | **ğŸ” Details** | **ğŸ“Š Reports**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Check the Artifacts section for test reports, SBOM, and security scans" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "</div>" >> $GITHUB_STEP_SUMMARY